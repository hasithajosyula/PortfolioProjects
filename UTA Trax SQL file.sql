--DROP TABLE
DROP TABLE RATING;
DROP TABLE RIDER_HISTORY;
DROP TABLE PAYMENT_DETAILS;
DROP TABLE TICKET;
DROP TABLE TICKET_TYPE;
DROP TABLE CUSTOMER;

--CREATE TABLE
CREATE TABLE CUSTOMER (
    CUSTOMER_ID   NUMBER(10) GENERATED BY DEFAULT AS IDENTITY 
    (START WITH 101 INCREMENT BY 1),
    FIRST_NAME    VARCHAR2(20) NOT NULL,
    LAST_NAME     VARCHAR2(20) NOT NULL,
    PHONE_NUMBER  VARCHAR2(14) NOT NULL UNIQUE,
    EMAIL_ADDRESS VARCHAR2(20),
    PRIMARY KEY ( CUSTOMER_ID )
);

CREATE TABLE TICKET_TYPE (
    TICKETTYPE_ID NUMBER(4) GENERATED BY DEFAULT AS IDENTITY 
    (START WITH 1 INCREMENT BY 1),
    TICKET_NAME VARCHAR2(100) NOT NULL,
    START_STATION VARCHAR2(40) NOT NULL,
    DESTINATION_STATION VARCHAR2(40) NOT NULL,
    FARE_TYPE VARCHAR2(20) NOT NULL,
    PRICE NUMBER(10,2) NOT NULL,
    PRIMARY KEY ( TICKETTYPE_ID )
);

CREATE TABLE TICKET (
    TRANSACTION_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY 
    (START WITH 1001 INCREMENT BY 1),
    CUSTOMER_ID        NUMBER(10),
    TICKETTYPE_ID      NUMBER(4),
    TICKET_ID          NUMBER(10),
    TRANSACTION_DATETIME TIMESTAMP NOT NULL,
    STATUS             VARCHAR2(10) NOT NULL,
    PRIMARY KEY ( TRANSACTION_ID ),
    CONSTRAINT "FK_Ticket.Customer_ID" FOREIGN KEY ( CUSTOMER_ID )
        REFERENCES CUSTOMER ( CUSTOMER_ID ),
    CONSTRAINT "FK_Ticket.TicketType_ID" FOREIGN KEY ( TICKETTYPE_ID )
        REFERENCES TICKET_TYPE ( TICKETTYPE_ID )
);

CREATE TABLE PAYMENT_DETAILS (
    CUSTOMER_ID     NUMBER(10),
    NAME_ON_CARD    VARCHAR2(20) NOT NULL,
    CARD_NUMBER     NUMBER(16) NOT NULL,
    EXPIRY_DATE     DATE NOT NULL,
    CVV             NUMBER(3) NOT NULL,
    BILLING_ZIPCODE NUMBER(8) NOT NULL,
    PRIMARY KEY ( CUSTOMER_ID ),
    CONSTRAINT "FK_Payment_Details.Customer_ID" FOREIGN KEY ( CUSTOMER_ID )
        REFERENCES CUSTOMER ( CUSTOMER_ID )
);

CREATE TABLE RATING (
    CUSTOMER_ID NUMBER(10),
    RATING_ID   NUMBER(10) GENERATED BY DEFAULT AS IDENTITY 
    (START WITH 4101 INCREMENT BY 1),
    TICKET_ID   NUMBER(10) NOT NULL,
    FEEDBACK    VARCHAR2(40),
    PRIMARY KEY ( CUSTOMER_ID,
                  RATING_ID ),
    CONSTRAINT "FK_Rating.Customer_ID" FOREIGN KEY ( CUSTOMER_ID )
        REFERENCES CUSTOMER ( CUSTOMER_ID )
);

CREATE TABLE RIDER_HISTORY (
    CUSTOMER_ID NUMBER(10),
    TICKET_ID   NUMBER(10),
    PRIMARY KEY ( CUSTOMER_ID,
                  TICKET_ID ),
    CONSTRAINT "FK_Rider_History.Customer_ID" FOREIGN KEY ( CUSTOMER_ID )
        REFERENCES CUSTOMER ( CUSTOMER_ID )
);


--INSERT QUERIES
--CUSTOMER
INSERT INTO CUSTOMER (
    FIRST_NAME,
    LAST_NAME,
    PHONE_NUMBER,
    EMAIL_ADDRESS
) VALUES (
    'SAM',
    'RYDER',
    '4056589084',
    'SRYDER@GMAIL.COM'
);
INSERT INTO CUSTOMER (
    FIRST_NAME,
    LAST_NAME,
    PHONE_NUMBER,
    EMAIL_ADDRESS
) VALUES (
    'GEORGE',
    'MILLER',
    '5068541205',
    'GMILLER@GMAIL.COM'
);
INSERT INTO CUSTOMER (
    FIRST_NAME,
    LAST_NAME,
    PHONE_NUMBER,
    EMAIL_ADDRESS
) VALUES (
    'JAMIE',
    'ANDERS',
    '6048204265',
    'JANDERS@GMAIL.COM'
);
INSERT INTO CUSTOMER (
    FIRST_NAME,
    LAST_NAME,
    PHONE_NUMBER,
    EMAIL_ADDRESS
) VALUES (
    'ASHLEY',
    'SUMMERS',
    '3855162905',
    'ASUMMERS@GMAIL.COM'
);


--TICKET_TYPE
INSERT INTO TICKET_TYPE (
    TICKET_NAME,
    START_STATION,
    DESTINATION_STATION,
    FARE_TYPE,
    PRICE
) VALUES (
    'ONE WAY',
    'WEST VALLEY CENTRAL',
    'AIRPORT',
    'NORMAL',
    2.5
);
INSERT INTO TICKET_TYPE (
    TICKET_NAME,
    START_STATION,
    DESTINATION_STATION,
    FARE_TYPE,
    PRICE
) VALUES (
    'ONE WAY',
    'WEST VALLEY CENTRAL',
    'AIRPORT',
    'DISCOUNTED',
    1.25
);
INSERT INTO TICKET_TYPE (
    TICKET_NAME,
    START_STATION,
    DESTINATION_STATION,
    FARE_TYPE,
    PRICE
) VALUES (
    'EXPRESS ONE WAY',
    'KOMAS DR',
    'OGDEN STATION',
    'NORMAL',
    5
);
INSERT INTO TICKET_TYPE (
    TICKET_NAME,
    START_STATION,
    DESTINATION_STATION,
    FARE_TYPE,
    PRICE
) VALUES (
    'EXPRESS ONE WAY',
    'KOMAS DR',
    'OGDEN STATION',
    'DISCOUNTED',
    2.5
);
INSERT INTO TICKET_TYPE (
    TICKET_NAME,
    START_STATION,
    DESTINATION_STATION,
    FARE_TYPE,
    PRICE
) VALUES (
    'PARK CITY ONE WAY',
    'MEADOWBROOK',
    'SALT LAKE CENTRAL',
    'NORMAL',
    5
);
INSERT INTO TICKET_TYPE (
    TICKET_NAME,
    START_STATION,
    DESTINATION_STATION,
    FARE_TYPE,
    PRICE
) VALUES (
    'PARK CITY ONE WAY',
    'MEADOWBROOK',
    'SALT LAKE CENTRAL',
    'DISCOUNTED',
    5
);

--TICKET
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    101,
    1,
    201,
    '10-JAN-2022 08:00:44.244',
    'INACTIVE'
);
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    104,
    4,
    202,
    '16-JAN-2022 11:29:14.162',
    'INACTIVE'
);
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    101,
    1,
    201,
    '20-JAN-2022 12:41:24.284',
    'ACTIVE'
);
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    101,
    1,
    201,
    '20-JAN-2022 03:11:24.284 PM',
    'EXPIRED'
);
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    104,
    4,
    202,
    '16-APR-2022 11:29:14.162',
    'EXPIRED'
);

INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    102,
    5,
    203,
    '25-JUN-2022 12:50:16.544',
    'INACTIVE'
);
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    102,
    5,
    203,
    '28-AUG-2022 9:20:24.801',
    'ACTIVE'
);
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    102,
    5,
    203,
    '28-AUG-2022 11:50:24.801',
    'EXPIRED'
);
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    101,
    5,
    204,
    '20-OCT-2022 05:04:28.940 PM',
    'INACTIVE'
);

--PAYMENT_DETAILS
INSERT INTO PAYMENT_DETAILS (
    CUSTOMER_ID,
    NAME_ON_CARD,
    CARD_NUMBER,
    EXPIRY_DATE,
    CVV,
    BILLING_ZIPCODE
) VALUES (
    101,
    'SAM RYDER',
    1004298065829540,
    '14-JUN-2026',
    264,
    84100
);
INSERT INTO PAYMENT_DETAILS (
    CUSTOMER_ID,
    NAME_ON_CARD,
    CARD_NUMBER,
    EXPIRY_DATE,
    CVV,
    BILLING_ZIPCODE
) VALUES (
    102,
    'GEORRGE MILLER',
    6254091426848604,
    '22-OCT-2028',
    802,
    84200
);
INSERT INTO PAYMENT_DETAILS (
    CUSTOMER_ID,
    NAME_ON_CARD,
    CARD_NUMBER,
    EXPIRY_DATE,
    CVV,
    BILLING_ZIPCODE
) VALUES (
    103,
    'JAMIE ANDERS',
    5264892155820026,
    '18-FEB-2030',
    081,
    84140
);
INSERT INTO PAYMENT_DETAILS (
    CUSTOMER_ID,
    NAME_ON_CARD,
    CARD_NUMBER,
    EXPIRY_DATE,
    CVV,
    BILLING_ZIPCODE
) VALUES (
    104,
    'ASHLEY SUMMERS',
    1204896106241645,
    '14-DEC-2032',
    648,
    84501
);

--RATING
INSERT INTO RATING (
    CUSTOMER_ID,
    RATING_ID,
    TICKET_ID,
    FEEDBACK
) VALUES(
    101,
    4101,
    201,
    'Good experience'
);
INSERT INTO RATING (
    CUSTOMER_ID,
    RATING_ID,
    TICKET_ID,
    FEEDBACK
) VALUES(
    104,
    4102,
    202,
    'Hard to navigate'
);
INSERT INTO RATING (
    CUSTOMER_ID,
    RATING_ID,
    TICKET_ID,
    FEEDBACK
) VALUES(
    102,
    4103,
    203,
    'Easy options to chose from'
);
INSERT INTO RATING (
    CUSTOMER_ID,
    RATING_ID,
    TICKET_ID,
    FEEDBACK
) VALUES(
    101,
    4104,
    204,
    ''
);

--RIDER_HISTORY
INSERT INTO RIDER_HISTORY (
    CUSTOMER_ID,
    TICKET_ID
) VALUES (
    101,
    201
);
INSERT INTO RIDER_HISTORY (
    CUSTOMER_ID,
    TICKET_ID
) VALUES (
    104,
    202
);
INSERT INTO RIDER_HISTORY (
    CUSTOMER_ID,
    TICKET_ID
) VALUES (
    102,
    203
);
INSERT INTO RIDER_HISTORY (
    CUSTOMER_ID,
    TICKET_ID
) VALUES (
    101,
    204
);

--FEATURE DEMONSTARTION
--FEATURE1
SELECT
    TICKET_ID,
    TICKET_NAME,
    PRICE,
    STATUS,
    TRANSACTION_DATETIME
FROM
         TICKET
    INNER JOIN TICKET_TYPE ON TICKET.TICKETTYPE_ID = TICKET_TYPE.TICKETTYPE_ID
WHERE
    TRANSACTION_ID IN (
        SELECT
            MAX(TRANSACTION_ID)
        FROM
            TICKET
        WHERE
            CUSTOMER_ID = '101'
        GROUP BY
            TICKET_ID
    );

--FEATURE2
UPDATE CUSTOMER SET EMAIL_ADDRESS = 'ASUMMERS@GMAIL.COM' WHERE CUSTOMER_ID = 104;
SELECT * FROM CUSTOMER WHERE CUSTOMER_ID = 104;

--FEATURE3
INSERT INTO TICKET (
    CUSTOMER_ID,
    TicketType_ID,
    TICKET_ID,
    TRANSACTION_DATETIME,
    STATUS
) VALUES (
    101,
    5,
    204,
    SYSDATE,
    'ACTIVE'
);

--SELECT
SELECT * FROM TICKET;
SELECT * FROM TICKET_TYPE;
SELECT * FROM RATING;
SELECT * FROM RIDER_HISTORY;
SELECT * FROM CUSTOMER;
SELECT * FROM PAYMENT_DETAILS;